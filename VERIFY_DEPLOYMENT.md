# éƒ¨ç½²éªŒè¯å’Œåç»­æ“ä½œæŒ‡å—

## âœ… éƒ¨ç½²çŠ¶æ€æ£€æŸ¥

ä½ çš„åº”ç”¨å·²ç»æˆåŠŸéƒ¨ç½²ï¼ä»è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼š
- âœ… Git ä»“åº“å·²å…‹éš†
- âœ… ä¾èµ–å·²å®‰è£…
- âœ… Next.js æ„å»ºæˆåŠŸ
- âœ… PM2 è¿›ç¨‹è¿è¡Œä¸­ï¼ˆçŠ¶æ€ï¼šonlineï¼‰
- âœ… Nginx é…ç½®æ­£ç¡®

## ğŸŒ è®¿é—®ä½ çš„ç½‘ç«™

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
http://8.217.67.198
```

ä½ åº”è¯¥èƒ½çœ‹åˆ°ä½ çš„ä½œå“é›†ç½‘ç«™äº†ï¼

## ğŸ“Š éªŒè¯éƒ¨ç½²çš„å‘½ä»¤

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ä¸€åˆ‡æ­£å¸¸ï¼š

```bash
# 1. æ£€æŸ¥ PM2 åº”ç”¨çŠ¶æ€
pm2 status

# 2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
pm2 logs portfolio --lines 50

# 3. æ£€æŸ¥åº”ç”¨æ˜¯å¦åœ¨ç›‘å¬ 3000 ç«¯å£
netstat -tulpn | grep :3000

# 4. æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://localhost:3000

# 5. æ£€æŸ¥ Nginx çŠ¶æ€
systemctl status nginx

# 6. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰
tail -f /var/log/nginx/error.log
```

## ğŸ”„ æ›´æ–°åº”ç”¨çš„æ­¥éª¤

å½“ä½ çš„ä»£ç æœ‰æ›´æ–°æ—¶ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
cd /var/www/portfolio

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å®‰è£…æ–°ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰
npm install

# é‡æ–°æ„å»º
npm run build

# é‡å¯åº”ç”¨
pm2 restart portfolio

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
pm2 logs portfolio --lines 20
```

## ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### PM2 ç®¡ç†
```bash
pm2 status              # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€
pm2 logs portfolio      # æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 restart portfolio   # é‡å¯åº”ç”¨
pm2 stop portfolio      # åœæ­¢åº”ç”¨
pm2 delete portfolio    # åˆ é™¤åº”ç”¨ï¼ˆéœ€è¦é‡æ–°å¯åŠ¨ï¼‰
pm2 monit               # å®æ—¶ç›‘æ§ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰
```

### Nginx ç®¡ç†
```bash
nginx -t                # æµ‹è¯•é…ç½®æ–‡ä»¶
systemctl reload nginx  # é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
systemctl restart nginx # é‡å¯ Nginx
systemctl status nginx  # æŸ¥çœ‹çŠ¶æ€
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# PM2 æ—¥å¿—
pm2 logs portfolio

# Nginx è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# ç³»ç»Ÿæ—¥å¿—
journalctl -u nginx -f
```

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. è®¾ç½® PM2 å¼€æœºè‡ªå¯
```bash
pm2 startup
# æ‰§è¡Œä¸Šé¢å‘½ä»¤è¾“å‡ºçš„ sudo å‘½ä»¤
```

### 2. é™åˆ¶ SSH è®¿é—®ï¼ˆé‡è¦ï¼ï¼‰
ä¿®æ”¹å®‰å…¨ç»„ï¼Œåªå…è®¸ä½ çš„ IP è®¿é—® SSH ç«¯å£ 22ï¼š
- ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
- è¿›å…¥ ECS â†’ å®‰å…¨ç»„
- ä¿®æ”¹å…¥ç«™è§„åˆ™ï¼Œé™åˆ¶ SSH (22) ç«¯å£åªå…è®¸ä½ çš„ IP

### 3. é…ç½®é˜²ç«å¢™
```bash
# Ubuntu/Debian
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw enable
```

## ğŸ” é…ç½® HTTPSï¼ˆæ¨èï¼‰

å¦‚æœä½ æœ‰åŸŸåï¼Œå¯ä»¥é…ç½® SSL è¯ä¹¦ï¼š

```bash
# å®‰è£… Certbot
apt install certbot python3-certbot-nginx -y

# è·å–è¯ä¹¦ï¼ˆæ›¿æ¢ä¸ºä½ çš„åŸŸåï¼‰
certbot --nginx -d yourdomain.com -d www.yourdomain.com

# è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸ
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
```bash
# æŸ¥çœ‹ PM2 ç›‘æ§
pm2 monit

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
# æˆ–
top

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

## ğŸ› æ•…éšœæ’æŸ¥

### å¦‚æœç½‘ç«™æ— æ³•è®¿é—®

1. **æ£€æŸ¥ PM2 çŠ¶æ€**
   ```bash
   pm2 status
   # å¦‚æœçŠ¶æ€ä¸æ˜¯ onlineï¼ŒæŸ¥çœ‹æ—¥å¿—
   pm2 logs portfolio
   ```

2. **æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨**
   ```bash
   netstat -tulpn | grep :3000
   ```

3. **æ£€æŸ¥ Nginx é…ç½®**
   ```bash
   nginx -t
   systemctl status nginx
   ```

4. **æ£€æŸ¥å®‰å…¨ç»„**
   - ç¡®ä¿é˜¿é‡Œäº‘å®‰å…¨ç»„å¼€æ”¾äº† 80 ç«¯å£

5. **æ£€æŸ¥é˜²ç«å¢™**
   ```bash
   ufw status
   # æˆ–
   firewall-cmd --list-all
   ```

### å¦‚æœå‡ºç° 502 Bad Gateway

```bash
# 1. ç¡®è®¤åº”ç”¨åœ¨è¿è¡Œ
pm2 status

# 2. ç¡®è®¤åº”ç”¨ç›‘å¬åœ¨ 3000 ç«¯å£
curl http://localhost:3000

# 3. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ proxy_pass
cat /etc/nginx/sites-available/portfolio

# 4. é‡å¯æœåŠ¡
pm2 restart portfolio
systemctl reload nginx
```

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… **è®¿é—®ç½‘ç«™**ï¼šåœ¨æµè§ˆå™¨æ‰“å¼€ `http://8.217.67.198`
2. ğŸ”’ **é…ç½®åŸŸå**ï¼šå¦‚æœæœ‰åŸŸåï¼Œé…ç½® DNS æŒ‡å‘ `8.217.67.198`
3. ğŸ” **é…ç½® HTTPS**ï¼šä½¿ç”¨ Certbot é…ç½® SSL è¯ä¹¦
4. ğŸ”„ **è®¾ç½®è‡ªåŠ¨æ›´æ–°**ï¼šå¯ä»¥è®¾ç½® cron job è‡ªåŠ¨æ‹‰å–æ›´æ–°ï¼ˆå¯é€‰ï¼‰

## ğŸ’¡ æç¤º

- åº”ç”¨æ—¥å¿—ä¼šä¿å­˜åœ¨ PM2 ä¸­ï¼Œä½¿ç”¨ `pm2 logs` æŸ¥çœ‹
- å¦‚æœä¿®æ”¹äº†ä»£ç ï¼Œè®°å¾— `git pull` åé‡æ–° `npm run build` å’Œ `pm2 restart`
- å»ºè®®å®šæœŸå¤‡ä»½ï¼š`pm2 save` ä¼šä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
- ç›‘æ§èµ„æºä½¿ç”¨ï¼Œå¦‚æœå†…å­˜/CPU ä½¿ç”¨è¿‡é«˜ï¼Œè€ƒè™‘å‡çº§å®ä¾‹

